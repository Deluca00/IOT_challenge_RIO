<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <title>Dashboard Medical</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap');

    body {
      font-family: 'Roboto Mono', monospace;
    }

    .camera-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
      background: rgba(0, 0, 0, 0.6);
      padding: 20px;
    }

    .camera-modal.open {
      display: flex;
    }

    .camera-grid {
      width: 100%;
      max-width: 1100px;
      background: white;
      border-radius: 14px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
    }

    .camera-card {
      border-radius: 8px;
      overflow: hidden;
      background: #000;
      height: 220px;
    }

    .camera-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .container {
      max-width: 960px;
      padding-left: 1rem;
      padding-right: 1rem;
    }

    @media (min-width: 640px) {
      .container {
        padding-left: 2rem;
        padding-right: 2rem;
      }
    }

    .grid {
      gap: 1.5rem;
    }

    @media (min-width: 768px) {
      .grid {
        gap: 2rem;
      }
    }
  </style>
</head>
<body class="bg-white text-gray-900 select-none">
  <div class="container mx-auto px-2 sm:px-4 py-4 sm:py-6 pb-28">
    <div class="flex justify-between items-start mb-2">
      <div class="text-xs text-gray-500 font-semibold">
        Mar 17 dic
      </div>
    </div>
    <div class="flex flex-col items-center mb-2">
      <div class="text-3xl sm:text-4xl font-extrabold text-[#43a047] tracking-widest mb-1 text-center">RIO TECH</div>
      <div class="flex flex-wrap justify-center gap-x-3 gap-y-2 sm:gap-x-6 text-2xl sm:text-3xl mb-1 w-full">
        <i class="fas fa-user-md text-[#1e88e5]"></i>
        <i class="fas fa-heartbeat text-[#e53935]"></i>
        <i class="fas fa-ambulance text-[#1e88e5]"></i>
        <i class="fas fa-stethoscope text-[#43a047]"></i>
        <i class="fas fa-notes-medical text-[#43a047]"></i>
      </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
      <div class="space-y-4 md:space-y-6">
        <div class="bg-[#e8f5e9] border-[#43a047] shadow-lg shadow-[#43a047]/20 rounded-2xl p-4 sm:p-6 w-full border-4 mx-auto transition hover:scale-[1.01]">
          <div class="flex flex-col sm:flex-row justify-between items-center sm:items-center mb-4 gap-2">
            <div class="flex items-center space-x-2">
              <img alt="Cloud icon" class="w-8 h-8 sm:w-10 sm:h-10" src="https://placehold.co/40x40/png?text=Cloud+Icon" />
              <div class="text-gray-700 text-xs font-semibold">
                Nebbia, 7°C
              </div>
            </div>
            <div class="text-gray-900 text-4xl sm:text-5xl font-bold tracking-wide leading-none" id="vn-clock">
              02:18
            </div>
          </div>
          <div class="text-gray-500 text-xs font-semibold mb-2 text-center sm:text-left">
            17/12/2024
          </div>
          <div class="space-y-2">
            <div class="flex items-center space-x-2 text-xs font-semibold">
              <div class="w-12 text-gray-700">Mar</div>
              <div class="text-[#e53935]">☀️</div>
              <div class="w-6 text-right text-gray-700">7°C</div>
              <div class="flex-1 h-3 rounded-full bg-[#e53935]/20 relative">
                <div class="absolute top-0 left-0 h-3 rounded-full bg-[#e53935]" style="width: 70%"></div>
              </div>
              <div class="w-6 text-left text-gray-700">15°C</div>
            </div>
            <div class="flex items-center space-x-2 text-xs font-semibold">
              <div class="w-12 text-gray-700">Mer</div>
              <div class="text-[#43a047]">☀️</div>
              <div class="w-6 text-right text-gray-700">7°C</div>
              <div class="flex-1 h-3 rounded-full bg-[#43a047]/20 relative">
                <div class="absolute top-0 left-0 h-3 rounded-full bg-[#43a047]" style="width: 70%"></div>
              </div>
              <div class="w-6 text-left text-gray-700">15°C</div>
            </div>
            <div class="flex items-center space-x-2 text-xs font-semibold">
              <div class="w-12 text-gray-700">Gio</div>
              <div class="text-[#1e88e5]">☀️</div>
              <div class="w-6 text-right text-gray-700">7°C</div>
              <div class="flex-1 h-3 rounded-full bg-[#1e88e5]/20 relative">
                <div class="absolute top-0 left-0 h-3 rounded-full bg-[#1e88e5]" style="width: 75%"></div>
              </div>
              <div class="w-6 text-left text-gray-700">16°C</div>
            </div>
          </div>
          <div class="flex flex-wrap justify-between mt-6 space-x-1 sm:space-x-3 text-gray-700 text-lg sm:text-xl">
            <button aria-label="Home lock" class="rounded-full p-2 bg-[#43a047]/80 hover:bg-[#43a047] transition">
              <i class="fas fa-lock"></i>
            </button>
            <button aria-label="Red circle" class="rounded-full p-2 bg-[#e53935]/80 hover:bg-[#e53935] transition">
              <i class="fas fa-heartbeat"></i>
            </button>
            <button aria-label="Leaf icon" class="rounded-full p-2 bg-[#43a047]/80 hover:bg-[#43a047] transition">
              <i class="fas fa-user-md"></i>
            </button>
            <button aria-label="Game controller" class="rounded-full p-2 bg-[#1e88e5]/80 hover:bg-[#1e88e5] transition">
              <i class="fas fa-ambulance"></i>
            </button>
            <button aria-label="Settings" class="rounded-full p-2 bg-[#1e88e5]/80 hover:bg-[#1e88e5] transition">
              <i class="fas fa-cog"></i>
            </button>
          </div>
        </div>
        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4 w-full mx-auto">
          <div class="flex flex-col justify-center items-center sm:items-start">
            <style>
              @keyframes pulse-medical {
                0%, 100% { box-shadow: 0 0 0 0 rgba(30, 136, 229, 0.4); }
                50% { box-shadow: 0 0 24px 8px rgba(30, 136, 229, 0.25); }
              }
              .medical-animate { animation: pulse-medical 1.8s infinite; }
              @keyframes rotate-medical {
                0% { transform: rotate(-10deg); }
                50% { transform: rotate(10deg); }
                100% { transform: rotate(-10deg); }
              }
              .medical-rotate { animation: rotate-medical 2.2s infinite; }
              @keyframes glow-medical {
                0%, 100% { filter: drop-shadow(0 0 0px #43a04788); }
                50% { filter: drop-shadow(0 0 16px #43a047cc); }
              }
              .medical-glow { animation: glow-medical 1.5s infinite; }
              @keyframes bounce-medical {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-10px); }
              }
              .medical-bounce { animation: bounce-medical 1.2s infinite; }
              @keyframes spin-slow {
                0% { transform: rotate(0); }
                100% { transform: rotate(360deg); }
              }
              .animate-spin-slow { animation: spin-slow 4s linear infinite; }
              @keyframes heartbeat-scale {
                0%, 100% { transform: scale(1); }
                20% { transform: scale(1.18); }
                40% { transform: scale(0.95); }
                60% { transform: scale(1.12); }
                80% { transform: scale(0.98); }
              }
              .heartbeat-real { animation: heartbeat-scale 1.1s infinite; }
              @keyframes shimmer {
                0% { opacity: 0.7; }
                50% { opacity: 1; filter: blur(2px); }
                100% { opacity: 0.7; }
              }
              .shimmer { animation: shimmer 1.3s infinite; }
              @keyframes float-particle {
                0% { opacity: 0; transform: translateY(30px) scale(0.7); }
                10% { opacity: 1; }
                80% { opacity: 1; }
                100% { opacity: 0; transform: translateY(-60px) scale(1.2); }
              }
              .particle {
                position: absolute;
                left: 50%;
                color: #b3e5fc;
                font-size: 1.1rem;
                pointer-events: none;
                z-index: 30;
              }
              .particle1 { animation: float-particle 2.8s linear infinite; animation-delay: 0s; }
              .particle2 { animation: float-particle 2.8s linear infinite; animation-delay: 0.7s; left: 60%; }
              .particle3 { animation: float-particle 2.8s linear infinite; animation-delay: 1.4s; left: 40%; }
            </style>
            <div class="relative flex items-center justify-center w-20 h-28 sm:w-[100px] sm:h-[140px]">
              <span class="particle particle1 shimmer" style="top:80px;">●</span>
              <span class="particle particle2 shimmer" style="top:100px;">●</span>
              <span class="particle particle3 shimmer" style="top:120px;">●</span>
              <span class="absolute left-1/2 top-2 -translate-x-1/2 text-[#e53935] text-3xl medical-animate medical-glow heartbeat-real z-30">
                <i class="fas fa-heartbeat"></i>
              </span>
              <span class="absolute left-1/2 top-10 -translate-x-1/2 text-[#43a047] text-3xl medical-rotate medical-bounce shimmer z-30">
                <i class="fas fa-stethoscope"></i>
              </span>
              <span class="absolute left-1/2 top-20 -translate-x-1/2 text-[#1e88e5] text-3xl animate-spin-slow medical-glow shimmer z-30">
                <i class="fas fa-user-md"></i>
              </span>
              <span class="absolute left-1/2 top-[90px] -translate-x-1/2 text-[#e53935] text-2xl medical-bounce shimmer z-30">
                <i class="fas fa-briefcase-medical"></i>
              </span>
              <span class="absolute left-1/2 top-[110px] -translate-x-1/2 text-[#43a047] text-xl medical-animate shimmer z-30">
                <i class="fas fa-plus-circle"></i>
              </span>
              <div class="absolute inset-0 rounded-lg bg-gradient-to-b from-white/90 via-[#e3f2fd]/70 to-[#e8f5e9]/80 border-2 border-[#43a047] shadow-2xl shadow-[#43a047]/40 z-10"></div>
              <div class="absolute left-2 top-2 w-3/4 h-2 rounded-full bg-white/60 shimmer z-40"></div>
            </div>
          </div>
          <div class="flex flex-col space-y-2 sm:space-y-3 w-full">
            <button class="flex items-center space-x-2 bg-[#ffebee] border border-[#e53935] rounded-full px-4 py-2 text-xs font-semibold shadow shadow-[#e53935]/10">
              <i class="fas fa-heartbeat text-[#e53935]"></i>
              <span>Nhịp Tim</span>
              <span class="ml-auto text-[#e53935]">Bình thường</span>
            </button>
            <button class="flex items-center space-x-2 bg-[#e3f2fd] border border-[#1e88e5] rounded-full px-4 py-2 text-xs font-semibold shadow shadow-[#1e88e5]/10">
              <i class="fas fa-tint text-[#1e88e5]"></i>
              <span>Oxy Máu</span>
              <span class="ml-auto text-[#1e88e5]">98%</span>
            </button>
            <button class="flex items-center space-x-2 bg-[#e8f5e9] border border-[#43a047] rounded-full px-4 py-2 text-xs font-semibold shadow shadow-[#43a047]/10">
              <i class="fas fa-thermometer-half text-[#43a047]"></i>
              <span>Nhiệt Độ</span>
              <span class="ml-auto text-[#43a047]">36.6°C</span>
            </button>
            <button class="flex items-center space-x-2 bg-[#e3f2fd] border border-[#1e88e5] rounded-full px-4 py-2 text-xs font-semibold shadow shadow-[#1e88e5]/10">
              <i class="fas fa-user-nurse text-[#1e88e5]"></i>
              <span>Bác sĩ</span>
              <span class="ml-auto text-[#1e88e5]">Trực</span>
            </button>
          </div>
        </div>
        <div class="flex space-x-2 sm:space-x-4 w-full mt-4 sm:mt-6 mx-auto">
          <button class="bg-[#ffebee] border-2 border-[#e53935] rounded-xl p-4 flex-1 flex justify-center items-center text-[#e53935] text-2xl font-bold shadow shadow-[#e53935]/20">
            <i class="fas fa-syringe"></i>
          </button>
          <button class="bg-[#e8f5e9] border-2 border-[#43a047] rounded-xl p-4 flex-1 flex justify-center items-center text-[#43a047] text-2xl font-bold shadow shadow-[#43a047]/20">
            <i class="fas fa-stethoscope"></i>
          </button>
          <button class="bg-[#e3f2fd] border-2 border-[#1e88e5] rounded-xl p-4 flex-1 flex justify-center items-center text-[#1e88e5] text-2xl font-bold shadow shadow-[#1e88e5]/20">
            <i class="fas fa-user-md"></i>
          </button>
          <button class="bg-gray-100 border-2 border-gray-300 rounded-xl p-4 flex-1 flex justify-center items-center text-gray-700 text-2xl font-bold shadow">
            <i class="fas fa-notes-medical"></i>
          </button>
        </div>
      </div>
      <div class="space-y-4 md:space-y-6">
        <div class="grid grid-cols-1 gap-2 sm:gap-3 w-full mx-auto">
          <div class="camera-card relative">
            <span class="absolute top-2 left-2 bg-black/60 text-white text-xs px-2 py-1 rounded">Camera Zone 5</span>
            <img id="cam-5" alt="cam 5" src="/barcode_feed/0" class="w-full h-full object-cover">
          </div>
          <div class="camera-card relative">
            <span class="absolute top-2 left-2 bg-black/60 text-white text-xs px-2 py-1 rounded">Camera Zone 6</span>
            <img id="cam-6" alt="cam 6" src="/barcode_feed/1" class="w-full h-full object-cover">
          </div>
        </div>
      </div>
    </div>
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-between sm:justify-center space-x-4 sm:space-x-20 py-2 sm:py-3 px-2 sm:px-0 z-50">
      <button class="text-[#43a047] text-xl sm:text-2xl">
        <i class="fas fa-home"></i>
      </button>
      <button id="btnNhapThuoc" class="text-[#e53935] text-xl sm:text-2xl">
        <i class="fas fa-th-large"></i>
      </button>
      <button id="btnBanthuoc" class="text-[#1e88e5] text-xl sm:text-2xl">
        <i class="fas fa-database"></i>
      </button>
      <div id="cameraDiv" class="fixed inset-0 bg-black/70 flex flex-col items-center justify-center hidden z-50 p-4">
        <video id="video" autoplay playsinline class="rounded-lg shadow-lg max-w-full max-h-[70vh] border-4 border-[#43a047]"></video>
        <button id="btnCapture" class="mt-4 bg-[#e53935] text-white font-bold py-2 px-6 rounded-full shadow-lg opacity-50 cursor-not-allowed" disabled>Chụp</button>
        <button id="btnClose" class="mt-2 text-white underline">Đóng</button>
      </div>
      <form id="form" method="POST" action="/scan_barcode">
        <input type="hidden" name="image" id="imageInput">
      </form>
      <button id="tdBtn" class="text-[#1e88e5] text-xl sm:text-2xl">
        <i class="fas fa-users"></i>
      </button>
      <button class="text-gray-700 text-xl sm:text-2xl">
        <i class="fas fa-cog"></i>
      </button>
    </nav>
    <div id="cameraModal" class="camera-modal">
      <div class="camera-grid">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-bold">Camera Medical — 4 view (OpenCV stream)</h3>
          <button class="px-3 py-1 rounded-md bg-red-500 text-white" onclick="closeCameraGrid()">Đóng</button>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="camera-card relative">
            <span class="absolute top-2 left-2 bg-black/60 text-white text-xs px-2 py-1 rounded">Camera Zone 1</span>
            <img id="cam-1" alt="cam 1">
          </div>
          <div class="camera-card relative">
            <span class="absolute top-2 left-2 bg-black/60 text-white text-xs px-2 py-1 rounded">Camera Zone 2</span>
            <img id="cam-2" alt="cam 2">
          </div>
          <div class="camera-card relative">
            <span class="absolute top-2 left-2 bg-black/60 text-white text-xs px-2 py-1 rounded">Camera Zone 3</span>
            <img id="cam-3" alt="cam 3">
          </div>
          <div class="camera-card relative">
            <span class="absolute top-2 left-2 bg-black/60 text-white text-xs px-2 py-1 rounded">Camera Zone 4</span>
            <img id="cam-4" alt="cam 4">
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    function updateVNClock() {
      const now = new Date();
      const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
      const vnTime = new Date(utc + (7 * 60 * 60 * 1000));
      let hours = vnTime.getHours();
      let minutes = vnTime.getMinutes();
      hours = hours < 10 ? '0' + hours : hours;
      minutes = minutes < 10 ? '0' + minutes : minutes;
      document.getElementById('vn-clock').textContent = `${hours}:${minutes}`;
    }
    updateVNClock();
    setInterval(updateVNClock, 1000);

    function openCameraGrid() {
      document.getElementById('cameraModal').classList.add('open');
      document.getElementById('cam-1').src = '/video_feed/1';
      document.getElementById('cam-2').src = '/video_feed/2';
      document.getElementById('cam-3').src = '/video_feed/3';
      document.getElementById('cam-4').src = '/video_feed/4';
    }

    function closeCameraGrid() {
      document.getElementById('cameraModal').classList.remove('open');
    }

    

    const btnNhapThuoc = document.getElementById("btnNhapThuoc");
    const btnbanthuoc = document.getElementById("btnBanthuoc");
    const btntd = document.getElementById("tdBtn");
    const cameraDiv = document.getElementById("cameraDiv");
    const video = document.getElementById("video");
    const btnCapture = document.getElementById("btnCapture");
    const btnClose = document.getElementById("btnClose");
    const form = document.getElementById("form");
    const imageInput = document.getElementById("imageInput");

    let stream = null;

    async function startCamera() {
      btnCapture.disabled = true;
      btnCapture.classList.add("opacity-50", "cursor-not-allowed");
      const constraints = {
        video: {
          facingMode: "environment",
          width: { ideal: 1280 },
          height: { ideal: 720 }
        }
      };

      try {
        stream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = stream;
        video.onloadedmetadata = () => {
          video.play();
          btnCapture.disabled = false;
          btnCapture.classList.remove("opacity-50", "cursor-not-allowed");
        };
      } catch (err) {
        alert("Không thể mở camera: " + err);
      }
    }

    function stopCamera() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
      }
      cameraDiv.classList.add("hidden");
    }

    btnNhapThuoc.addEventListener("click", () => {
      cameraDiv.classList.remove("hidden");
        console.log("Nút thêm thuốc đã được nhấn!");
      startCamera();
    });

    btnbanthuoc.addEventListener("click", () => {
      window.location.href = "/banthuoc";
    });

    btnCapture.addEventListener("click", () => {
      const canvas = document.createElement("canvas");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext("2d");
      ctx.filter = "contrast(150%) brightness(110%)";
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      canvas.toBlob((blob) => {
        if (!blob) { console.error("Blob is null"); return; }
        const formData = new FormData();
        formData.append("image", blob, "capture.jpg");
        fetch("/scan_barcode", { method: "POST", body: formData })
          .then(res => {
            if (res.redirected) {
              window.location.href = res.url;
            }
          });
      }, "image/jpeg", 1.0);
      stopCamera();
    });

    btnClose.addEventListener("click", stopCamera);

    btntd.addEventListener("click", () => {
      window.location.href = "/td_page";
    });
  </script>
</body>
</html>